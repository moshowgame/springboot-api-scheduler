 <!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Scheduler</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="app" class="container-fluid">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">üöÄ SpringBoot-API-Scheduler</a>
                <div class="navbar-nav me-auto">
                    <a class="nav-link" href="#" @click="showTasks">üìã ‰ªªÂä°ÁÆ°ÁêÜ</a>
                    <a class="nav-link" href="#" @click="showLogs">üìä ÊâßË°åÊó•Âøó</a>
                    <a class="nav-link" href="#" @click="showAlerts">üîî Ë≠¶Êä•ËÆ∞ÂΩï</a>
                </div>
                <div class="navbar-nav">
                    <span class="navbar-text me-3">üë§ {{ currentUser }}</span>
                    <a class="nav-link" href="#" @click="logout">üö™ ÈÄÄÂá∫</a>
                </div>
            </div>
        </nav>

        <!-- ‰ªªÂä°ÁÆ°ÁêÜÈ°µÈù¢ -->
        <div v-if="currentView === 'tasks'" class="mt-4">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5>API‰ªªÂä°ÁÆ°ÁêÜ</h5>
                                <div>
                                    <button class="btn btn-warning me-2" @click="showAlertConfigModal">
                                        <i class="bi bi-bell"></i> Ë≠¶Êä•ÈÖçÁΩÆ
                                    </button>
                                    <button class="btn btn-primary" @click="showAddTaskModal">Ê∑ªÂä†‰ªªÂä°</button>
                                </div>
                            </div>
                            <div class="mt-2">
                                <div class="d-flex align-items-center">
                                    <div class="form-check me-3">
                                        <input class="form-check-input" type="checkbox" id="selectAllTasks" 
                                               @change="toggleSelectAll" :checked="allTasksSelected">
                                        <label class="form-check-label" for="selectAllTasks">
                                            ÂÖ®ÈÄâ
                                        </label>
                                    </div>
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-outline-success btn-sm" 
                                                @click="batchStartTasks" :disabled="!selectedTasks || selectedTasks.length === 0">
                                            ÊâπÈáèÂêØÂä®
                                        </button>
                                        <button type="button" class="btn btn-outline-warning btn-sm" 
                                                @click="batchPauseTasks" :disabled="!selectedTasks || selectedTasks.length === 0">
                                            ÊâπÈáèÊöÇÂÅú
                                        </button>
                                        <button type="button" class="btn btn-outline-info btn-sm" 
                                                @click="batchEnableAlerts" :disabled="!selectedTasks || selectedTasks.length === 0">
                                            ÂêØÁî®Ë≠¶Êä•
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm" 
                                                @click="batchDisableAlerts" :disabled="!selectedTasks || selectedTasks.length === 0">
                                            Á¶ÅÁî®Ë≠¶Êä•
                                        </button>
                                    </div>
                                    <span class="ms-3 text-muted" v-if="selectedTasks && selectedTasks.length > 0">
                                        Â∑≤ÈÄâÊã© {{ selectedTasks.length }} ‰∏™‰ªªÂä°
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th style="width: 40px;">ÈÄâÊã©</th>
                                        <th>ID</th>
                                        <th>‰ªªÂä°ÂêçÁß∞</th>
                                        <th>URL</th>
                                        <th>ÊñπÊ≥ï</th>
                                        <th>CronË°®ËææÂºè</th>
                                        <th>Áä∂ÊÄÅ</th>
                                        <th>Ë≠¶Êä•</th>
                                        <th>Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="task in tasks" :key="task.id">
                                        <td>
                                            <input class="form-check-input" type="checkbox" 
                                                   :value="task.id" v-model="selectedTasks">
                                        </td>
                                        <td>{{ task.id }}</td>
                                        <td>{{ task.taskName }}</td>
                                        <td>{{ task.url }}</td>
                                        <td>{{ task.method }}</td>
                                        <td>{{ task.cronExpression }}</td>
                                        <td>
                                            <span :class="getStatusClass(task.status)">{{ task.status }}</span>
                                        </td>
                                        <td>
                                            <span v-if="task.alertEnabled" class="badge bg-success">Â∑≤ÂêØÁî®</span>
                                            <span v-else class="badge bg-secondary">Â∑≤Á¶ÅÁî®</span>
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-success" @click="startTask(task.id)" v-if="task.status === 'PAUSED'">ÂêØÂä®</button>
                                            <button class="btn btn-sm btn-warning" @click="pauseTask(task.id)" v-if="task.status === 'RUNNING'">ÊöÇÂÅú</button>
                                            <button class="btn btn-sm btn-info" @click="executeTask(task.id)">ÊâßË°å</button>
                                            <button class="btn btn-sm btn-primary" @click="configAssertions(task)">Êñ≠Ë®Ä</button>
                                            <button class="btn btn-sm btn-outline-info" @click="viewTaskLogs(task.id)">Êó•Âøó</button>
                                            <button class="btn btn-sm btn-outline-secondary" @click="copyTask(task)">Â§çÂà∂</button>
                                            <button class="btn btn-sm btn-secondary" @click="editTask(task)">ÁºñËæë</button>
                                            <button class="btn btn-sm btn-danger" @click="deleteTask(task.id)">Âà†Èô§</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÊâßË°åÊó•ÂøóÈ°µÈù¢ -->
        <div v-if="currentView === 'logs'" class="mt-4">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <!-- Êó∂Èó¥ËåÉÂõ¥Êü•ËØ¢ -->
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <div class="card border-primary">
                                        <div class="card-header bg-primary text-white py-2">
                                            <i class="fas fa-calendar-alt me-2"></i>Êó•ÂøóÁ≠õÈÄâ
                                        </div>
                                        <div class="card-body">
                                            <div class="d-flex align-items-center flex-wrap">
                                                <div class="d-flex align-items-center">
                                                    <button class="btn btn-primary btn-sm me-2" @click="refreshLogs">
                                                        üîÑ Âà∑Êñ∞
                                                    </button>
                                                    <select class="form-select me-2" style="width: 300px;" v-model="selectedTaskId" @change="filterLogsByTask">
                                                        <option value="">ÊâÄÊúâ‰ªªÂä°</option>
                                                        <option v-for="task in allTasks" :key="task.id" :value="task.id">
                                                            {{ task.taskName }} ({{ task.url }})
                                                        </option>
                                                    </select>
                                                </div>

                                                <label class="form-label me-2 mb-0 fw-bold">ÂºÄÂßãÊó∂Èó¥:</label>
                                                <input type="datetime-local" class="form-control form-control-sm me-3" 
                                                       style="width: 220px;" 
                                                       v-model="timeRange.startTime">
                                                <label class="form-label me-2 mb-0 fw-bold">ÁªìÊùüÊó∂Èó¥:</label>
                                                <input type="datetime-local" class="form-control form-control-sm me-3" 
                                                       style="width: 220px;" 
                                                       v-model="timeRange.endTime">
                                                <button class="btn btn-outline-primary btn-sm me-2" @click="applyTimeRange">
                                                    <i class="fas fa-search me-1"></i>Â∫îÁî®Á≠õÈÄâ
                                                </button>
                                                <button class="btn btn-outline-secondary btn-sm" @click="clearTimeRange">
                                                    <i class="fas fa-times me-1"></i>Ê∏ÖÈô§Á≠õÈÄâ
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ‰∏äÊñπÂàÜÈ°µÊéß‰ª∂ -->
                            <nav class="mt-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="alert alert-info mb-0 py-2">
                                        <small>
                                            <i class="fas fa-info-circle me-1"></i>
                                            <!--<strong>ÂΩìÂâçÁ≠õÈÄâÔºö</strong>
                                            {{ getSelectedTaskName() }}-->
                                            <span class="ms-2">ÂÖ± {{ totalLogs }} Êù°ËÆ∞ÂΩïÔºåÂΩìÂâçÊòæÁ§∫Á¨¨ {{ (currentPage-1)*pageSize+1 }} - {{ Math.min(currentPage*pageSize, totalLogs) }} Êù°</span>
                                        </small>
                                    </div>
                                    <div class="d-flex align-items-center bg-light p-2 rounded">
                                        <button class="btn btn-sm btn-outline-primary me-2"
                                                :disabled="currentPage <= 1"
                                                @click="goToPage(currentPage - 1)">
                                            ‰∏ä‰∏ÄÈ°µ
                                        </button>
                                        <button class="btn btn-sm btn-outline-primary"
                                                :disabled="currentPage >= totalPages"
                                                @click="goToPage(currentPage + 1)">
                                            ‰∏ã‰∏ÄÈ°µ
                                        </button>
                                        <label class="form-label me-2 mb-0">ÊØèÈ°µÊòæÁ§∫Ôºö</label>
                                        <select class="form-select form-select-sm" style="width: auto;" v-model="pageSize" @change="changePageSize">
                                            <option value="10">10Êù°</option>
                                            <option value="50">50Êù°</option>
                                            <option value="100">100Êù°</option>
                                            <option value="500">500Êù°</option>
                                        </select>
                                    </div>
                                </div>
                            </nav>
                        </div>
                        <div class="card-body">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>ËØ∑Ê±ÇURL</th>
                                        <th>ÊñπÊ≥ï</th>
                                        <th>ÂìçÂ∫îÁ†Å</th>
                                        <th>ÂìçÂ∫îÊó∂Èó¥(ms)</th>
                                        <th>Áä∂ÊÄÅ</th>
                                        <th>Êñ≠Ë®ÄÁªìÊûú</th>
                                        <th>ÊâßË°åÊó∂Èó¥</th>
                                        <th>Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="log in filteredLogs" :key="log.id">
                                        <td>{{ log.id }}</td>
                                        <td>{{ log.requestUrl }}</td>
                                        <td>{{ log.requestMethod }}</td>
                                        <td>{{ log.responseCode }}</td>
                                        <td>{{ log.responseTime }}</td>
                                        <td>
                                            <span :class="getStatusClass(log.status)">{{ log.status }}</span>
                                        </td>
                                        <td style="max-width: 250px;">
                                            <div v-if="log.assertionResult" :class="getAssertionClass(log.allAssertionsPassed)">
                                                <div v-if="log.assertionResult.length <= 50" 
                                                     style="word-break: break-all; line-height: 1.4;">
                                                    {{ log.assertionResult }}
                                                </div>
                                                <div v-else>
                                                    <div v-if="!log.expandedAssertion" 
                                                         style="word-break: break-all; line-height: 1.4;">
                                                        {{ log.assertionResult.substring(0, 50) }}...
                                                        <a href="#" @click.prevent="toggleAssertionExpanded(log)" 
                                                           class="text-decoration-none ms-1">
                                                            <small>Â±ïÂºÄ</small>
                                                        </a>
                                                    </div>
                                                    <div v-else 
                                                         style="word-break: break-all; line-height: 1.4;">
                                                        {{ log.assertionResult }}
                                                        <a href="#" @click.prevent="toggleAssertionExpanded(log)" 
                                                           class="text-decoration-none ms-1">
                                                            <small>Êî∂Ëµ∑</small>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                            <span v-else class="text-muted">Êó†Êñ≠Ë®Ä</span>
                                        </td>
                                        <td>{{ formatDateTime(log.executeTime) }}</td>
                                        <td>
                                            <button class="btn btn-sm btn-info" @click="viewLogDetail(log)">ËØ¶ÊÉÖ</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <!-- ‰∏ãÊñπÂàÜÈ°µÊéß‰ª∂ -->
                            <nav v-if="totalPages > 1" class="mt-3">
                                <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded mb-2">
                                    <div class="d-flex align-items-center">
                                        <span class="me-2 text-muted">
                                            <i class="fas fa-list me-1"></i>
                                            ÂÖ± {{ totalLogs }} Êù°ËÆ∞ÂΩïÔºåÂΩìÂâçÊòæÁ§∫Á¨¨ {{ (currentPage-1)*pageSize+1 }} - {{ Math.min(currentPage*pageSize, totalLogs) }} Êù°
                                        </span>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <div class="d-flex align-items-center me-4">
                                            <span class="me-2">Ë∑≥ËΩ¨Âà∞</span>
                                            <input type="number" class="form-control form-control-sm me-2" 
                                                   style="width: 80px;" 
                                                   v-model.number="jumpToPage" 
                                                   :min="1" 
                                                   :max="totalPages">
                                            <button class="btn btn-sm btn-primary me-3" @click="goToJumpedPage">
                                                <i class="fas fa-arrow-right me-1"></i>Á°ÆÂÆö
                                            </button>
                                        </div>
                                        <div>
                                            <button class="btn btn-sm btn-outline-primary me-2" 
                                                    :disabled="currentPage <= 1" 
                                                    @click="goToPage(currentPage - 1)">
                                                <i class="fas fa-chevron-left me-1"></i>‰∏ä‰∏ÄÈ°µ
                                            </button>
                                            <button class="btn btn-sm btn-outline-primary" 
                                                    :disabled="currentPage >= totalPages" 
                                                    @click="goToPage(currentPage + 1)">
                                                ‰∏ã‰∏ÄÈ°µ<i class="fas fa-chevron-right ms-1"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <ul class="pagination justify-content-center mb-0">
                                    <li class="page-item" :class="{ disabled: currentPage <= 1 }">
                                        <a class="page-link" href="#" @click.prevent="goToPage(currentPage - 1)">‰∏ä‰∏ÄÈ°µ</a>
                                    </li>
                                    <li v-for="page in displayedPages" :key="page" 
                                        class="page-item" :class="{ active: page === currentPage }">
                                        <a class="page-link" href="#" @click.prevent="goToPage(page)">{{ page }}</a>
                                    </li>
                                    <li class="page-item" :class="{ disabled: currentPage >= totalPages }">
                                        <a class="page-link" href="#" @click.prevent="goToPage(currentPage + 1)">‰∏ã‰∏ÄÈ°µ</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ë≠¶Êä•ËÆ∞ÂΩïÈ°µÈù¢ -->
        <div v-if="currentView === 'alerts'" class="mt-4">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5>üîî Ë≠¶Êä•ËÆ∞ÂΩï</h5>
                                <div class="d-flex align-items-center">
                                    <input type="text" class="form-control me-2" placeholder="Êåâ‰ªªÂä°ÂêçÁß∞Á≠õÈÄâ" 
                                           v-model="alertFilterTaskName" style="width: 250px;">
                                    <button class="btn btn-primary" @click="loadAlertRecords">
                                        <i class="fas fa-search me-1"></i>Á≠õÈÄâ
                                    </button>
                                    <button class="btn btn-outline-secondary ms-2" @click="clearAlertFilter">
                                        <i class="fas fa-times me-1"></i>Ê∏ÖÈô§
                                    </button>
                                    <button class="btn btn-primary ms-2" @click="loadAlertRecords">
                                        <i class="fas fa-sync-alt me-1"></i>Âà∑Êñ∞
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>‰ªªÂä°ÂêçÁß∞</th>
                                        <th>Ë≠¶Êä•Ê∂àÊÅØ</th>
                                        <th>Â§±Ë¥•Áéá</th>
                                        <th>Â§±Ë¥•Ê¨°Êï∞/ÊÄªÊ¨°Êï∞</th>
                                        <th>Ëß¶ÂèëÊó∂Èó¥</th>
                                        <th>APIÂú∞ÂùÄ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="alert in alertRecords" :key="alert.id">
                                        <td>{{ alert.taskName }}</td>
                                        <td>{{ alert.alertMessage }}</td>
                                        <td>{{ alert.failureRate }}%</td>
                                        <td>{{ alert.failureCount }}/{{ alert.totalCount }}</td>
                                        <td>{{ formatDateTime(alert.alertTime) }}</td>
                                        <td>{{ alert.apiUrl }}</td>
                                    </tr>
                                    <tr v-if="alertRecords.length === 0">
                                        <td colspan="6" class="text-center text-muted">ÊöÇÊó†Ë≠¶Êä•ËÆ∞ÂΩï</td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <!-- Ë≠¶Êä•ËÆ∞ÂΩïÂàÜÈ°µÊéß‰ª∂ -->
                            <nav v-if="alertTotalPages > 1" class="mt-3">
                                <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded mb-2">
                                    <div class="d-flex align-items-center">
                                        <span class="me-2 text-muted">
                                            <i class="fas fa-list me-1"></i>
                                            ÂÖ± {{ alertTotalRecords }} Êù°ËÆ∞ÂΩïÔºåÂΩìÂâçÊòæÁ§∫Á¨¨ {{ (alertCurrentPage-1)*alertPageSize+1 }} - {{ Math.min(alertCurrentPage*alertPageSize, alertTotalRecords) }} Êù°
                                        </span>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <div class="d-flex align-items-center me-4">
                                            <span class="me-2">Ë∑≥ËΩ¨Âà∞</span>
                                            <input type="number" class="form-control form-control-sm me-2" 
                                                   style="width: 80px;" 
                                                   v-model.number="alertJumpToPage" 
                                                   :min="1" 
                                                   :max="alertTotalPages">
                                            <button class="btn btn-sm btn-primary me-3" @click="goToAlertPage(alertJumpToPage)">
                                                <i class="fas fa-arrow-right me-1"></i>Á°ÆÂÆö
                                            </button>
                                        </div>
                                        <div>
                                            <button class="btn btn-sm btn-outline-primary me-2" 
                                                    :disabled="alertCurrentPage <= 1" 
                                                    @click="goToAlertPage(alertCurrentPage - 1)">
                                                <i class="fas fa-chevron-left me-1"></i>‰∏ä‰∏ÄÈ°µ
                                            </button>
                                            <button class="btn btn-sm btn-outline-primary" 
                                                    :disabled="alertCurrentPage >= alertTotalPages" 
                                                    @click="goToAlertPage(alertCurrentPage + 1)">
                                                ‰∏ã‰∏ÄÈ°µ<i class="fas fa-chevron-right ms-1"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <ul class="pagination justify-content-center mb-0">
                                    <li class="page-item" :class="{ disabled: alertCurrentPage <= 1 }">
                                        <a class="page-link" href="#" @click.prevent="goToAlertPage(alertCurrentPage - 1)">‰∏ä‰∏ÄÈ°µ</a>
                                    </li>
                                    <li v-for="page in alertDisplayedPages" :key="page" 
                                        class="page-item" :class="{ active: page === alertCurrentPage }">
                                        <a class="page-link" href="#" @click.prevent="goToAlertPage(page)">{{ page }}</a>
                                    </li>
                                    <li class="page-item" :class="{ disabled: alertCurrentPage >= alertTotalPages }">
                                        <a class="page-link" href="#" @click.prevent="goToAlertPage(alertCurrentPage + 1)">‰∏ã‰∏ÄÈ°µ</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ê∑ªÂä†/ÁºñËæë‰ªªÂä°Ê®°ÊÄÅÊ°Ü -->
        <div class="modal fade" id="taskModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{{ editingTask ? 'ÁºñËæë‰ªªÂä°' : 'Ê∑ªÂä†‰ªªÂä°' }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="mb-3">
                                <label class="form-label">‰ªªÂä°ÂêçÁß∞</label>
                                <input type="text" class="form-control" v-model="currentTask.taskName">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">URL</label>
                                <input type="text" class="form-control" v-model="currentTask.url">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ÊñπÊ≥ï</label>
                                <select class="form-select" v-model="currentTask.method">
                                    <option value="GET">GET</option>
                                    <option value="POST">POST</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Ë∂ÖÊó∂Êó∂Èó¥(ms)</label>
                                <input type="number" class="form-control" v-model="currentTask.timeout">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">CronË°®ËææÂºè</label>
                                <input type="text" class="form-control" v-model="currentTask.cronExpression" 
                                       placeholder="‰æãÂ¶Ç: 0 */5 * * * ? (ÊØè5ÂàÜÈíüÊâßË°å‰∏ÄÊ¨°)">
                                <div class="mt-2">
                                    <small class="text-muted">Â∏∏Áî®CronË°®ËææÂºèÁ§∫‰æãÔºö</small>
                                    <div class="row mt-2">
                                        <div class="col-md-6">
                                            <button type="button" class="btn btn-sm btn-outline-primary me-1 mb-1" 
                                                    @click="setCronExpression('0 */1 * * * ?')">ÊØè1ÂàÜÈíü</button>
                                            <button type="button" class="btn btn-sm btn-outline-primary me-1 mb-1" 
                                                    @click="setCronExpression('0 */5 * * * ?')">ÊØè5ÂàÜÈíü</button>
                                            <button type="button" class="btn btn-sm btn-outline-primary me-1 mb-1" 
                                                    @click="setCronExpression('0 */10 * * * ?')">ÊØè10ÂàÜÈíü</button>
                                            <button type="button" class="btn btn-sm btn-outline-primary me-1 mb-1" 
                                                    @click="setCronExpression('0 */30 * * * ?')">ÊØè30ÂàÜÈíü</button>
                                            <button type="button" class="btn btn-sm btn-outline-primary me-1 mb-1" 
                                                    @click="setCronExpression('0 0 * * * ?')">ÊØèÂ∞èÊó∂</button>
                                            <button type="button" class="btn btn-sm btn-outline-primary me-1 mb-1" 
                                                    @click="setCronExpression('0 0 */2 * * ?')">ÊØè2Â∞èÊó∂</button>
                                        </div>
                                        <div class="col-md-6">
                                            <button type="button" class="btn btn-sm btn-outline-success me-1 mb-1" 
                                                    @click="setCronExpression('0 0 0 * * ?')">ÊØèÂ§©ÂáåÊô®</button>
                                            <button type="button" class="btn btn-sm btn-outline-success me-1 mb-1" 
                                                    @click="setCronExpression('0 30 8 * * ?')">ÊØèÂ§©8:30</button>
                                            <button type="button" class="btn btn-sm btn-outline-success me-1 mb-1" 
                                                    @click="setCronExpression('0 0 9 * * MON')">ÊØèÂë®‰∏Ä9ÁÇπ</button>
                                            <button type="button" class="btn btn-sm btn-outline-success me-1 mb-1" 
                                                    @click="setCronExpression('0 0 1 * * ?')">ÊØèÊúà1Âè∑</button>
                                            <button type="button" class="btn btn-sm btn-outline-info me-1 mb-1" 
                                                    @click="setCronExpression('0 0 9 ? * MON-FRI')">Â∑•‰ΩúÊó•9ÁÇπ</button>
                                            <button type="button" class="btn btn-sm btn-outline-info me-1 mb-1" 
                                                    @click="setCronExpression('0 0 10 ? * SAT,SUN')">Âë®Êú´10ÁÇπ</button>
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-muted">Ê†ºÂºèËØ¥ÊòéÔºöÁßí ÂàÜ Êó∂ Êó• Êúà Âë® [Âπ¥]</small>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Headers (JSONÊ†ºÂºè)</label>
                                <textarea class="form-control" v-model="currentTask.headers" rows="3"
                                          placeholder='{"Content-Type": "application/json"}'></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Parameters (JSONÊ†ºÂºè)</label>
                                <textarea class="form-control" v-model="currentTask.parameters" rows="3"
                                          placeholder='{"key": "value"}'></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ÊèèËø∞</label>
                                <textarea class="form-control" v-model="currentTask.description" rows="2"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂèñÊ∂à</button>
                        <button type="button" class="btn btn-primary" @click="saveTask">‰øùÂ≠ò</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Êó•ÂøóËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü -->
        <div class="modal fade" id="logDetailModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Êó•ÂøóËØ¶ÊÉÖ</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div v-if="currentLog">
                            <div class="mb-3">
                                <label class="form-label">ËØ∑Ê±ÇURL</label>
                                <input type="text" class="form-control" :value="currentLog.requestUrl" readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ËØ∑Ê±ÇÊñπÊ≥ï</label>
                                <input type="text" class="form-control" :value="currentLog.requestMethod" readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ËØ∑Ê±ÇHeaders</label>
                                <textarea class="form-control" v-model="currentLog.requestHeaders" rows="3" readonly></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ËØ∑Ê±ÇÂèÇÊï∞</label>
                                <textarea class="form-control" v-model="currentLog.requestParams" rows="3" readonly></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ÂìçÂ∫îÁ†Å</label>
                                <input type="text" class="form-control" :value="currentLog.responseCode" readonly>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ÂìçÂ∫î‰Ωì</label>
                                <textarea class="form-control" v-model="currentLog.responseBody" rows="10" readonly></textarea>
                            </div>
                            <div v-if="currentLog.errorMessage" class="mb-3">
                                <label class="form-label">ÈîôËØØ‰ø°ÊÅØ</label>
                                <textarea class="form-control" v-model="currentLog.errorMessage" rows="3" readonly></textarea>
                            </div>
                            <div v-if="currentLog.assertionResult" class="mb-3">
                                <label class="form-label">Êñ≠Ë®ÄÁªìÊûú</label>
                                <div class="alert" :class="currentLog.allAssertionsPassed ? 'alert-success' : 'alert-danger'">
                                    {{ currentLog.assertionResult }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Êñ≠Ë®ÄÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü -->
        <div class="modal fade" id="assertionConfigModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Êñ≠Ë®ÄÈÖçÁΩÆ - {{ currentConfigTask.taskName || 'Êú™Áü•‰ªªÂä°' }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <h6 class="mb-3">Êñ≠Ë®ÄËßÑÂàô</h6>
                            
                            <div class="card">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-md-3">
                                            <label class="form-label">Êñ≠Ë®ÄÁ±ªÂûã</label>
                                            <select class="form-select" v-model="currentAssertion.assertionType">
                                                <option value="">ÈÄâÊã©Á±ªÂûã</option>
                                                <option value="HTTP_CODE">HTTPÁä∂ÊÄÅÁ†Å</option>
                                                <option value="JSON_CONTAINS">JSONÂåÖÂê´ÂÖ≥ÈîÆÂ≠ó</option>
                                                <option value="JSON_PATH">JSONË∑ØÂæÑ</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">ÊúüÊúõÂÄº</label>
                                            <input type="text" class="form-control" 
                                                   v-model="currentAssertion.expectedValue" 
                                                   :placeholder="getAssertionPlaceholder(currentAssertion.assertionType)">
                                        </div>
                                        <div class="col-md-3">
                                        </div>
                                    </div>
                                    <div v-if="currentAssertion.assertionType" class="mt-3">
                                        <div class="alert alert-info">
                                            <h6 class="alert-heading">{{ getAssertionTitle(currentAssertion.assertionType) }}</h6>
                                            <div class="mb-2">{{ getAssertionDescription(currentAssertion.assertionType) }}</div>
                                            <div class="mt-2">
                                                <strong>Á§∫‰æãÔºö</strong>
                                                <div class="mt-1 p-2 bg-light rounded">
                                                    <code>{{ getAssertionExample(currentAssertion.assertionType) }}</code>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂèñÊ∂à</button>
                        <button type="button" class="btn btn-primary" @click="saveAssertions">‰øùÂ≠òÊñ≠Ë®Ä</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ë≠¶Êä•ÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü -->
        <div class="modal fade" id="alertConfigModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">ÈîôËØØË≠¶Êä•ÈÖçÁΩÆ</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-info">
                            <h6 class="alert-heading">Ë≠¶Êä•ÂäüËÉΩËØ¥Êòé</h6>
                            <p>ÂΩì‰ªªÂä°Âú®ÊåáÂÆöÊó∂Èó¥ÂÜÖÁöÑÊñ≠Ë®ÄÂ§±Ë¥•ÁéáË∂ÖËøáÈòàÂÄºÊó∂ÔºåÁ≥ªÁªüÂ∞ÜËá™Âä®ÂèëÈÄÅHTTPËØ∑Ê±ÇÂà∞ÊÇ®ÈÖçÁΩÆÁöÑAPIÂú∞ÂùÄ„ÄÇ</p>
                            <ul>
                                <li>Êó∂Èó¥Á™óÂè£ÔºöÊ£ÄÊü•ËøáÂéªNÂàÜÈíüÂÜÖÁöÑÊâßË°åËÆ∞ÂΩïÔºàN‰∏∫Ê£ÄÊü•Èó¥ÈöîÈÖçÁΩÆÁöÑÂàÜÈíüÊï∞Ôºâ</li>
                                <li>Â§±Ë¥•ÁéáËÆ°ÁÆóÔºöÂ§±Ë¥•Ê¨°Êï∞ / ÊÄªÊâßË°åÊ¨°Êï∞ √ó 100%</li>
                                <li>Ëß¶ÂèëÊù°‰ª∂ÔºöÂ§±Ë¥•ÁéáË∂ÖËøáËÆæÂÆöÁöÑÈòàÂÄº</li>
                                <li>Ê£ÄÊü•È¢ëÁéáÔºöÊØèÂ∞èÊó∂Ê£ÄÊü•‰∏ÄÊ¨°ÔºåÊª°Ë∂≥Ê£ÄÊü•Èó¥ÈöîÊó∂ÊâßË°åÂÖ∑‰ΩìÊ£ÄÊü•</li>
                            </ul>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Â§±Ë¥•ÁéáÈòàÂÄº (%)</label>
                                    <input type="number" class="form-control" v-model="alertConfig.failureRateThreshold" 
                                           min="1" max="100" placeholder="‰æãÂ¶Ç: 50">
                                    <div class="form-text">ÂΩìÂ§±Ë¥•ÁéáË∂ÖËøáÊ≠§ÂÄºÊó∂Ëß¶ÂèëË≠¶Êä•</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Ê£ÄÊü•Èó¥Èöî (ÂàÜÈíü)</label>
                                    <input type="number" class="form-control" v-model="alertConfig.checkInterval" 
                                           min="5" max="1440" placeholder="‰æãÂ¶Ç: 30">
                                    <div class="form-text">Á≥ªÁªüÊ£ÄÊü•Ë≠¶Êä•ÁöÑÊó∂Èó¥Èó¥ÈöîÔºåÂêåÊó∂ÂÜ≥ÂÆöÊ£ÄÊü•ÁöÑÊó∂Èó¥Á™óÂè£</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Ë≠¶Êä•APIÂú∞ÂùÄ</label>
                            <input type="text" class="form-control" v-model="alertConfig.apiUrl" 
                                   placeholder="‰æãÂ¶Ç: https://api.example.com/alert">
                            <div class="form-text">Ë≠¶Êä•Ëß¶ÂèëÊó∂Ë∞ÉÁî®ÁöÑAPIÂú∞ÂùÄ</div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">ËØ∑Ê±ÇÊñπÊ≥ï</label>
                                    <select class="form-select" v-model="alertConfig.httpMethod">
                                        <option value="GET">GET</option>
                                        <option value="POST">POST</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">ËØ∑Ê±ÇÂ§¥ (JSONÊ†ºÂºè)</label>
                                    <textarea class="form-control" v-model="alertConfig.headers" rows="2"
                                              placeholder='{"Content-Type": "application/json"}'></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">ËØ∑Ê±Ç‰Ωì (JSONÊ†ºÂºè)</label>
                            <textarea class="form-control" v-model="alertConfig.body" rows="3"
                                      placeholder='{"message": "API‰ªªÂä°Êñ≠Ë®ÄÂ§±Ë¥•ÁéáËøáÈ´ò", "taskId": "${taskId}", "taskName": "${taskName}", "failureRate": "${failureRate}%"}'></textarea>
                            <div class="form-text">ÂèØ‰ΩøÁî®ÂèòÈáè: ${taskId}, ${taskName}, ${failureRate}, ${failureCount}, ${totalCount}</div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" v-model="alertConfig.enabled">
                                <label class="form-check-label">ÂêØÁî®Ë≠¶Êä•ÂäüËÉΩ</label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂèñÊ∂à</button>
                        <button type="button" class="btn btn-primary" @click="saveAlertConfig">‰øùÂ≠òÈÖçÁΩÆ</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    currentView: 'tasks',
                    tasks: [],
                    logs: [],
                    allTasks: [], // Áî®‰∫éÊó•ÂøóÁ≠õÈÄâÁöÑ‰ªªÂä°ÂàóË°®
                    filteredLogs: [], // Á≠õÈÄâÂêéÁöÑÊó•Âøó
                    selectedTaskId: '', // ÂΩìÂâçÈÄâ‰∏≠ÁöÑ‰ªªÂä°ID
                    selectedTasks: [], // ÊâπÈáèÈÄâ‰∏≠ÁöÑ‰ªªÂä°IDÂàóË°®
                    currentTask: {},
                    currentLog: {},
                    currentAssertion: {
                        assertionType: 'HTTP_CODE',
                        expectedValue: ''
                    },
                    currentConfigTask: {},
                    editingTask: false,
                    // Ë≠¶Êä•ÈÖçÁΩÆÁõ∏ÂÖ≥
                    alertConfig: {
                        failureRateThreshold: 50, // Â§±Ë¥•ÁéáÈòàÂÄº(%)
                        checkInterval: 30, // Ê£ÄÊü•Èó¥Èöî(ÂàÜÈíü)
                        apiUrl: '', // Ë≠¶Êä•APIÂú∞ÂùÄ
                        httpMethod: 'POST', // ËØ∑Ê±ÇÊñπÊ≥ï
                        headers: '{"Content-Type": "application/json"}', // ËØ∑Ê±ÇÂ§¥
                        body: '{"message": "API‰ªªÂä°Êñ≠Ë®ÄÂ§±Ë¥•ÁéáËøáÈ´ò", "taskId": "${taskId}", "taskName": "${taskName}", "failureRate": "${failureRate}%"}', // ËØ∑Ê±Ç‰Ωì
                        enabled: false // ÊòØÂê¶ÂêØÁî®
                    },
                    taskModal: null,
                    logDetailModal: null,
                    assertionConfigModal: null,
                    alertConfigModal: null,
                    currentUser: '',
                    // ÂàÜÈ°µÁõ∏ÂÖ≥
                    currentPage: 1,
                    pageSize: 50,
                    totalPages: 0,
                    totalLogs: 0,
                    // Èò≤ÊäñÁõ∏ÂÖ≥
                    lastRefreshTime: 0,
                    refreshCooldown: 1000, // 1ÁßíÂÜ∑Âç¥Êó∂Èó¥
                    // Ë∑≥ËΩ¨È°µÈù¢
                    jumpToPage: 1,
                    // Êó∂Èó¥ËåÉÂõ¥Êü•ËØ¢
                    timeRange: {
                        startTime: '',
                        endTime: ''
                    },
                    // Ë≠¶Êä•ËÆ∞ÂΩïÁõ∏ÂÖ≥
                    alertRecords: [],
                    alertFilterTaskName: '',
                    // Ë≠¶Êä•ËÆ∞ÂΩïÂàÜÈ°µÁõ∏ÂÖ≥
                    alertCurrentPage: 1,
                    alertPageSize: 50,
                    alertTotalRecords: 0,
                    alertTotalPages: 0,
                    alertJumpToPage: 1
                };
            },
            mounted() {
                // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
                this.checkAuth();
                
                this.taskModal = new bootstrap.Modal(document.getElementById('taskModal'));
                this.logDetailModal = new bootstrap.Modal(document.getElementById('logDetailModal'));
                this.assertionConfigModal = new bootstrap.Modal(document.getElementById('assertionConfigModal'));
                this.alertConfigModal = new bootstrap.Modal(document.getElementById('alertConfigModal'));
                this.loadTasks();
                this.loadLogs();
            },
            methods: {
                showTasks() {
                    this.currentView = 'tasks';
                },
                showLogs() {
                    this.currentView = 'logs';
                    this.currentPage = 1;
                    this.selectedTaskId = '';
                    this.loadLogs();
                },
                showAlerts() {
                    this.currentView = 'alerts';
                    this.alertCurrentPage = 1;
                    this.loadAlertRecords();
                },
                async loadTasks() {
                    try {
                        const response = await axios.get('/api/tasks');
                        this.tasks = (response.data && response.data.data) ? response.data.data : [];
                        this.allTasks = [...this.tasks]; // Â§çÂà∂‰ªªÂä°ÂàóË°®Áî®‰∫éÁ≠õÈÄâ
                    } catch (error) {
                        console.error('Failed to load tasks:', error);
                        this.tasks = [];
                        this.allTasks = [];
                    }
                },
                async loadLogs() {
                    try {
                        const params = {
                            page: this.currentPage,
                            size: this.pageSize
                        };
                        
                        // Ê∑ªÂä†Êó∂Èó¥ËåÉÂõ¥ÂèÇÊï∞Ôºà‰ΩøÁî®Êú¨Âú∞Êó∂Èó¥Ê†ºÂºèÔºâ
                        if (this.timeRange.startTime) {
                            params.startTime = this.timeRange.startTime;
                            //params.startTime = this.formatDateTimeForAPI(this.timeRange.startTime);
                        }
                        if (this.timeRange.endTime) {
                            params.endTime = this.timeRange.endTime;
                            //params.endTime = this.formatDateTimeForAPI(this.timeRange.endTime);
                        }
                        
                        // Ê∑ªÂä†‰ªªÂä°Á≠õÈÄâÂèÇÊï∞
                        if (this.selectedTaskId) {
                            params.taskId = this.selectedTaskId;
                        }
                        
                        const response = await axios.get('/api/responses', { params });
                        this.logs = (response.data && response.data.data) ? response.data.data : [];
                        this.filteredLogs = [...this.logs]; // ÂàùÂßãÂåñÁ≠õÈÄâÂêéÁöÑÊó•Âøó
                        console.log('response.data:', response.data);
                        this.totalLogs = response.data?.total || 0;
                        this.totalPages = Math.ceil(this.totalLogs / this.pageSize);
                    } catch (error) {
                        console.error('Failed to load logs:', error);
                        this.logs = [];
                        this.filteredLogs = [];
                        this.totalLogs = 0;
                        this.totalPages = 0;
                    }
                },
                // Êó•ÂøóÁ≠õÈÄâÁõ∏ÂÖ≥ÊñπÊ≥ï
                async filterLogsByTask() {
                    // Áªü‰∏Ä‰ΩøÁî®loadLogsÊñπÊ≥ïÂ§ÑÁêÜÊâÄÊúâÁ≠õÈÄâÊù°‰ª∂
                    await this.loadLogs();
                },
                async loadTaskLogs(taskId) {
                    // Áªü‰∏Ä‰ΩøÁî®loadLogsÊñπÊ≥ïÂ§ÑÁêÜÊâÄÊúâÁ≠õÈÄâÊù°‰ª∂
                    await this.loadLogs();
                },
                async clearLogFilter() {
                    this.selectedTaskId = '';
                    this.timeRange.startTime = '';
                    this.timeRange.endTime = '';
                    this.currentPage = 1;
                    await this.loadLogs();
                },
                getSelectedTaskName() {
                    if (!this.selectedTaskId) return '';
                    const task = this.allTasks.find(t => t.id === this.selectedTaskId);
                    return task ? `${task.taskName} (${task.url})` : 'Êú™Áü•‰ªªÂä°';
                },
                async viewTaskLogs(taskId) {
                    this.selectedTaskId = taskId;
                    this.currentView = 'logs';
                    this.currentPage = 1;
                    // Áªü‰∏Ä‰ΩøÁî®loadLogsÊñπÊ≥ïÂ§ÑÁêÜÊâÄÊúâÁ≠õÈÄâÊù°‰ª∂
                    await this.loadLogs();
                },
                showAddTaskModal() {
                    this.editingTask = false;
                    this.currentTask = {
                        taskName: '',
                        url: '',
                        method: 'GET',
                        timeout: 30000,
                        cronExpression: '',
                        headers: '',
                        parameters: '',
                        description: ''
                    };
                    this.taskModal.show();
                },
                async editTask(task) {
                    this.editingTask = true;
                    this.currentTask = { ...task };
                    this.taskModal.show();
                },
                copyTask(task) {
                    this.editingTask = false; // ËÆæÁΩÆ‰∏∫Êñ∞Â¢ûÊ®°Âºè
                    // Â§çÂà∂‰ªªÂä°ÁöÑÊâÄÊúâÂ±ûÊÄßÔºå‰ΩÜ‰∏çÂåÖÂê´IDÂíåÊñ≠Ë®Ä
                    this.currentTask = {
                        taskName: task.taskName + ' (ÂâØÊú¨)',
                        url: task.url,
                        method: task.method,
                        timeout: task.timeout,
                        cronExpression: task.cronExpression,
                        headers: task.headers,
                        parameters: task.parameters,
                        description: task.description
                    };
                    this.taskModal.show();
                },
                async saveTask() {
                    try {
                        // ‰øùÂ≠ò‰ªªÂä°
                        if (this.editingTask) {
                            await axios.put(`/api/tasks/${this.currentTask.id}`, this.currentTask);
                        } else {
                            await axios.post('/api/tasks', this.currentTask);
                        }
                        
                        this.taskModal.hide();
                        this.loadTasks();
                    } catch (error) {
                        console.error('Failed to save task:', error);
                    }
                },
                async deleteTask(id) {
                    if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™‰ªªÂä°ÂêóÔºü')) {
                        try {
                            await axios.delete(`/api/tasks/${id}`);
                            this.loadTasks();
                        } catch (error) {
                            console.error('Failed to delete task:', error);
                        }
                    }
                },
                async startTask(id) {
                    try {
                        await axios.post(`/api/tasks/${id}/start`);
                        this.loadTasks();
                    } catch (error) {
                        console.error('Failed to start task:', error);
                    }
                },
                async pauseTask(id) {
                    try {
                        await axios.post(`/api/tasks/${id}/pause`);
                        this.loadTasks();
                    } catch (error) {
                        console.error('Failed to pause task:', error);
                    }
                },
                async executeTask(id) {
                    try {
                        await axios.post(`/api/tasks/${id}/execute`);
                        alert('‰ªªÂä°Â∑≤Êèê‰∫§ÊâßË°å');
                    } catch (error) {
                        console.error('Failed to execute task:', error);
                    }
                },
                viewLogDetail(log) {
                    this.currentLog = log;
                    this.logDetailModal.show();
                },
                getStatusClass(status) {
                    return {
                        'badge bg-success': status === 'RUNNING' || status === 'SUCCESS',
                        'badge bg-warning': status === 'PAUSED',
                        'badge bg-danger': status === 'ERROR'
                    };
                },
                formatDateTime(dateTime) {
                    if (!dateTime) return '';
                    return new Date(dateTime).toLocaleString();
                },
                setCronExpression(expression) {
                    this.currentTask.cronExpression = expression;
                },
                toggleAssertionExpanded(log) {
                    // Vue 3 ‰∏≠Áõ¥Êé•ËµãÂÄºÂç≥ÂèØÂÆûÁé∞ÂìçÂ∫îÂºèÊõ¥Êñ∞
                    log.expandedAssertion = !log.expandedAssertion;
                },
                async checkAuth() {
                    try {
                        const response = await axios.get('/api/auth/check');
                        if (response.data.authenticated) {
                            this.currentUser = response.data.username;
                        } else {
                            window.location.href = '/login';
                        }
                    } catch (error) {
                        console.error('Auth check failed:', error);
                        window.location.href = '/login';
                    }
                },
                async logout() {
                    try {
                        await axios.post('/api/auth/logout');
                        window.location.href = '/login';
                    } catch (error) {
                        console.error('Logout failed:', error);
                        window.location.href = '/login';
                    }
                },
                // Êñ≠Ë®ÄÁõ∏ÂÖ≥ÊñπÊ≥ï
                async loadTaskAssertions(taskId) {
                    try {
                        const response = await axios.get(`/api/assertions/task/${taskId}`);
                        const assertions = (response.data && response.data.data) ? response.data.data : [];
                        if (assertions.length > 0) {
                            this.currentAssertion = {
                                id: assertions[0].id,
                                assertionType: assertions[0].assertionType,
                                expectedValue: assertions[0].expectedValue
                            };
                        } else {
                            this.currentAssertion = {
                                assertionType: 'HTTP_CODE',
                                expectedValue: ''
                            };
                        }
                    } catch (error) {
                        console.error('Failed to load task assertions:', error);
                        this.currentAssertion = {
                            assertionType: 'HTTP_CODE',
                            expectedValue: ''
                        };
                    }
                },

                addAssertion() {
                    // Âçï‰∏™Êñ≠Ë®ÄÔºå‰∏çÈúÄË¶ÅÊ∑ªÂä†ÊñπÊ≥ï
                },
                removeAssertion(index) {
                    // Âçï‰∏™Êñ≠Ë®ÄÔºå‰∏çÈúÄË¶ÅÂà†Èô§ÊñπÊ≥ï
                },
                getAssertionPlaceholder(type) {
                    switch (type) {
                        case 'HTTP_CODE':
                            return '‰æãÂ¶Ç: 200, 500';
                        case 'JSON_CONTAINS':
                            return '‰æãÂ¶Ç: success, error';
                        case 'JSON_PATH':
                            return '‰æãÂ¶Ç: $.msg, $.data.status';
                        default:
                            return 'ËØ∑ÈÄâÊã©Êñ≠Ë®ÄÁ±ªÂûã';
                    }
                },
                getAssertionDescription(type) {
                    switch (type) {
                        case 'HTTP_CODE':
                            return 'Ê£ÄÊü•HTTPÂìçÂ∫îÁä∂ÊÄÅÁ†ÅÊòØÂê¶Á≠â‰∫éÊåáÂÆöÂÄº';
                        case 'JSON_CONTAINS':
                            return 'Ê£ÄÊü•ÂìçÂ∫î‰ΩìÊòØÂê¶ÂåÖÂê´ÊåáÂÆöÁöÑÂÖ≥ÈîÆÂ≠ó';
                        case 'JSON_PATH':
                            return '‰ΩøÁî®JSONPathË°®ËææÂºèÊ£ÄÊü•ÂìçÂ∫î‰Ωì‰∏≠ÁöÑÁâπÂÆöÂ≠óÊÆµÂÄº';
                        default:
                            return '';
                    }
                },
                getAssertionTitle(type) {
                    switch (type) {
                        case 'HTTP_CODE':
                            return 'HTTPÁä∂ÊÄÅÁ†ÅÊñ≠Ë®Ä';
                        case 'JSON_CONTAINS':
                            return 'JSONÂåÖÂê´ÂÖ≥ÈîÆÂ≠óÊñ≠Ë®Ä';
                        case 'JSON_PATH':
                            return 'JSONË∑ØÂæÑÊñ≠Ë®Ä';
                        default:
                            return '';
                    }
                },
                getAssertionExample(type) {
                    switch (type) {
                        case 'HTTP_CODE':
                            return `ÊúüÊúõÂÄº: 200
Áî®ÈÄî: È™åËØÅAPIËØ∑Ê±ÇÊàêÂäüËøîÂõû
Â∏∏ËßÅÂÄº: 200(ÊàêÂäü), 400(ÂÆ¢Êà∑Á´ØÈîôËØØ), 500(ÊúçÂä°Âô®ÈîôËØØ)`;
                        case 'JSON_CONTAINS':
                            return `ÊúüÊúõÂÄº: success
Áî®ÈÄî: Ê£ÄÊü•ÂìçÂ∫î‰Ωì‰∏≠ÊòØÂê¶ÂåÖÂê´ÊàêÂäüÊ†áËØÜ
ÂÖ∂‰ªñÁ§∫‰æã: error, "status":"ok", "message"`;
                        case 'JSON_PATH':
                            return `ÊúüÊúõÂÄº: $.code
Áî®ÈÄî: Ê£ÄÊü•JSONÂìçÂ∫î‰∏≠ÁâπÂÆöÂ≠óÊÆµÁöÑÂÄº
ÂÖ∂‰ªñÁ§∫‰æã: $.data.status, $.users[0].name, $.msg`;
                        default:
                            return '';
                    }
                },

                getAssertionClass(passed) {
                    return {
                        'badge bg-success': passed === true,
                        'badge bg-danger': passed === false,
                        'badge bg-secondary': passed === null || passed === undefined
                    };
                },
                // Êñ≠Ë®ÄÈÖçÁΩÆÁõ∏ÂÖ≥ÊñπÊ≥ï
                async configAssertions(task) {
                    this.currentConfigTask = { ...task };
                    await this.loadTaskAssertions(task.id);
                    this.assertionConfigModal.show();
                },
                async saveAssertions() {
                    try {
                        if (!this.currentConfigTask || !this.currentConfigTask.id) {
                            console.error('No task selected for assertion configuration');
                            return;
                        }
                        
                        if (this.currentAssertion && this.currentAssertion.assertionType && this.currentAssertion.expectedValue) {
                            await axios.post(`/api/assertions/task/${this.currentConfigTask.id}`, this.currentAssertion);
                        } else {
                            // Â¶ÇÊûúÊ≤°ÊúâÊñ≠Ë®ÄÈÖçÁΩÆÔºåÂà†Èô§Áé∞ÊúâÊñ≠Ë®Ä
                            await axios.delete(`/api/assertions/task/${this.currentConfigTask.id}`);
                        }
                        this.assertionConfigModal.hide();
                        this.loadTasks();
                    } catch (error) {
                        console.error('Failed to save assertions:', error);
                        alert('‰øùÂ≠òÊñ≠Ë®ÄÂ§±Ë¥•: ' + (error.response?.data?.message || error.message));
                    }
                },
                // Ë≠¶Êä•ÈÖçÁΩÆÁõ∏ÂÖ≥ÊñπÊ≥ï
                showAlertConfigModal() {
                    this.alertConfigModal.show();
                },
                async saveAlertConfig() {
                    try {
                        // È™åËØÅÈÖçÁΩÆ
                        if (!this.alertConfig.failureRateThreshold || this.alertConfig.failureRateThreshold <= 0 || this.alertConfig.failureRateThreshold > 100) {
                            alert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÂ§±Ë¥•ÁéáÈòàÂÄº(1-100)');
                            return;
                        }
                        
                        if (!this.alertConfig.checkInterval || this.alertConfig.checkInterval < 5 || this.alertConfig.checkInterval > 1440) {
                            alert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊ£ÄÊü•Èó¥Èöî(5-1440ÂàÜÈíü)');
                            return;
                        }
                        
                        if (!this.alertConfig.apiUrl) {
                            alert('ËØ∑ËæìÂÖ•Ë≠¶Êä•APIÂú∞ÂùÄ');
                            return;
                        }
                        
                        // ‰øùÂ≠òÈÖçÁΩÆÂà∞ÂêéÁ´Ø
                        await axios.post('/api/alert/config', this.alertConfig);
                        
                        this.alertConfigModal.hide();
                        alert('Ë≠¶Êä•ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò');
                    } catch (error) {
                        console.error('Failed to save alert config:', error);
                        alert('‰øùÂ≠òË≠¶Êä•ÈÖçÁΩÆÂ§±Ë¥•: ' + (error.response?.data?.message || error.message));
                    }
                },
                // Ë≠¶Êä•ËÆ∞ÂΩïÁõ∏ÂÖ≥ÊñπÊ≥ï
                async loadAlertRecords() {
                    try {
                        const params = {
                            page: this.alertCurrentPage,
                            size: this.alertPageSize
                        };
                        if (this.alertFilterTaskName) {
                            params.taskName = this.alertFilterTaskName;
                        }
                        
                        const response = await axios.get('/api/alert/records', { params });
                        this.alertRecords = (response.data && response.data.data) ? response.data.data : [];
                        this.alertTotalRecords = response.data?.total || 0;
                        this.alertTotalPages = Math.ceil(this.alertTotalRecords / this.alertPageSize);
                    } catch (error) {
                        console.error('Failed to load alert records:', error);
                        this.alertRecords = [];
                        this.alertTotalRecords = 0;
                        this.alertTotalPages = 0;
                    }
                },
                clearAlertFilter() {
                    this.alertFilterTaskName = '';
                    this.alertCurrentPage = 1;
                    this.loadAlertRecords();
                },
                // Ë≠¶Êä•ËÆ∞ÂΩïÂàÜÈ°µÁõ∏ÂÖ≥ÊñπÊ≥ï
                async changeAlertPageSize() {
                    this.alertCurrentPage = 1;
                    await this.loadAlertRecords();
                },
                async goToAlertPage(page) {
                    if (page < 1 || page > this.alertTotalPages) return;
                    this.alertCurrentPage = page;
                    await this.loadAlertRecords();
                },
                // ÊâπÈáèÊìç‰ΩúÁõ∏ÂÖ≥ÊñπÊ≥ï
                toggleSelectAll() {
                    if (this.allTasksSelected) {
                        this.selectedTasks = [];
                    } else {
                        this.selectedTasks = this.tasks.map(task => task.id);
                    }
                },
                get allTasksSelected() {
                    return this.tasks && this.tasks.length > 0 && 
                           this.selectedTasks && this.selectedTasks.length === this.tasks.length;
                },
                async batchStartTasks() {
                    try {
                        const selectedCount = this.selectedTasks.length;
                        for (const taskId of this.selectedTasks) {
                            await axios.post(`/api/tasks/${taskId}/start`);
                        }
                        this.selectedTasks = [];
                        this.loadTasks();
                        alert(`Â∑≤ÂêØÂä® ${selectedCount} ‰∏™‰ªªÂä°`);
                    } catch (error) {
                        console.error('Failed to start tasks:', error);
                        alert('ÊâπÈáèÂêØÂä®‰ªªÂä°Â§±Ë¥•');
                    }
                },
                async batchPauseTasks() {
                    try {
                        const selectedCount = this.selectedTasks.length;
                        for (const taskId of this.selectedTasks) {
                            await axios.post(`/api/tasks/${taskId}/pause`);
                        }
                        this.selectedTasks = [];
                        this.loadTasks();
                        alert(`Â∑≤ÊöÇÂÅú ${selectedCount} ‰∏™‰ªªÂä°`);
                    } catch (error) {
                        console.error('Failed to pause tasks:', error);
                        alert('ÊâπÈáèÊöÇÂÅú‰ªªÂä°Â§±Ë¥•');
                    }
                },
                async batchEnableAlerts() {
                    try {
                        const selectedCount = this.selectedTasks.length;
                        for (const taskId of this.selectedTasks) {
                            await axios.post(`/api/alert/enable/${taskId}`);
                        }
                        this.selectedTasks = [];
                        this.loadTasks();
                        alert(`Â∑≤‰∏∫ ${selectedCount} ‰∏™‰ªªÂä°ÂêØÁî®Ë≠¶Êä•`);
                    } catch (error) {
                        console.error('Failed to enable alerts:', error);
                        alert('ÊâπÈáèÂêØÁî®Ë≠¶Êä•Â§±Ë¥•');
                    }
                },
                async batchDisableAlerts() {
                    try {
                        const selectedCount = this.selectedTasks.length;
                        for (const taskId of this.selectedTasks) {
                            await axios.post(`/api/alert/disable/${taskId}`);
                        }
                        this.selectedTasks = [];
                        this.loadTasks();
                        alert(`Â∑≤‰∏∫ ${selectedCount} ‰∏™‰ªªÂä°Á¶ÅÁî®Ë≠¶Êä•`);
                    } catch (error) {
                        console.error('Failed to disable alerts:', error);
                        alert('ÊâπÈáèÁ¶ÅÁî®Ë≠¶Êä•Â§±Ë¥•');
                    }
                },
                // ÂàÜÈ°µÁõ∏ÂÖ≥ÊñπÊ≥ï
                async refreshLogs() {
                    const currentTime = Date.now();
                    if (currentTime - this.lastRefreshTime < this.refreshCooldown) {
                        const remainingTime = Math.ceil((this.refreshCooldown - (currentTime - this.lastRefreshTime)) / 1000);
                        alert(`ËØ∑Á≠âÂæÖ ${remainingTime} ÁßíÂêéÂÜçÂà∑Êñ∞`);
                        return;
                    }
                    
                    this.lastRefreshTime = currentTime;
                    this.currentPage = 1;
                    
                    // Áªü‰∏Ä‰ΩøÁî®loadLogsÊñπÊ≥ïÂ§ÑÁêÜÊâÄÊúâÁ≠õÈÄâÊù°‰ª∂
                    await this.loadLogs();
                },
                async changePageSize() {
                    this.currentPage = 1;
                    // Áªü‰∏Ä‰ΩøÁî®loadLogsÊñπÊ≥ïÂ§ÑÁêÜÊâÄÊúâÁ≠õÈÄâÊù°‰ª∂
                    await this.loadLogs();
                },
                async goToPage(page) {
                    if (page < 1 || page > this.totalPages) return;
                    this.currentPage = page;
                    this.jumpToPage = page; // ÂêåÊ≠•Ë∑≥ËΩ¨ËæìÂÖ•Ê°ÜÁöÑÂÄº
                    // Áªü‰∏Ä‰ΩøÁî®loadLogsÊñπÊ≥ïÂ§ÑÁêÜÊâÄÊúâÁ≠õÈÄâÊù°‰ª∂
                    await this.loadLogs();
                },
                async goToJumpedPage() {
                    if (this.jumpToPage < 1 || this.jumpToPage > this.totalPages) {
                        alert(`ËØ∑ËæìÂÖ•1Âà∞${this.totalPages}‰πãÈó¥ÁöÑÈ°µÁ†Å`);
                        return;
                    }
                    await this.goToPage(this.jumpToPage);
                },
                // Êó∂Èó¥ËåÉÂõ¥Êü•ËØ¢Áõ∏ÂÖ≥ÊñπÊ≥ï
                async applyTimeRange() {
                    this.currentPage = 1;
                    // Áªü‰∏Ä‰ΩøÁî®loadLogsÊñπÊ≥ïÂ§ÑÁêÜÊâÄÊúâÁ≠õÈÄâÊù°‰ª∂
                    await this.loadLogs();
                },
                async clearTimeRange() {
                    this.timeRange.startTime = '';
                    this.timeRange.endTime = '';
                    this.currentPage = 1;
                    // Áªü‰∏Ä‰ΩøÁî®loadLogsÊñπÊ≥ïÂ§ÑÁêÜÊâÄÊúâÁ≠õÈÄâÊù°‰ª∂
                    await this.loadLogs();
                },
                // Êó•ÊúüÊó∂Èó¥Ê†ºÂºèÂåñÊñπÊ≥ïÔºà‰øùÁïôÊ≠§ÊñπÊ≥ï‰ª•Èò≤ÂÖ∂‰ªñÂú∞Êñπ‰ΩøÁî®Ôºå‰ΩÜ‰∏çÂÜçÁî®‰∫éAPIË∞ÉÁî®Ôºâ
                formatDateTimeForAPI(dateTimeLocal) {
                    if (!dateTimeLocal) return '';
                    // Â∞ÜÊú¨Âú∞Êó∂Èó¥Ê†ºÂºèËΩ¨Êç¢‰∏∫APIÈúÄË¶ÅÁöÑÊ†ºÂºè
                    const date = new Date(dateTimeLocal);
                    return date.toISOString();
                },
                formatDateTimeLocal(dateTimeLocal) {
                    if (!dateTimeLocal) return '';
                    // Ê†ºÂºèÂåñÊú¨Âú∞Êó∂Èó¥ÊòæÁ§∫
                    const date = new Date(dateTimeLocal);
                    return date.toLocaleString();
                }
            },
            computed: {
                displayedPages() {
                    const pages = [];
                    const start = Math.max(1, this.currentPage - 2);
                    const end = Math.min(this.totalPages, this.currentPage + 2);
                    
                    for (let i = start; i <= end; i++) {
                        pages.push(i);
                    }
                    return pages;
                },
                alertDisplayedPages() {
                    const pages = [];
                    const start = Math.max(1, this.alertCurrentPage - 2);
                    const end = Math.min(this.alertTotalPages, this.alertCurrentPage + 2);
                    
                    for (let i = start; i <= end; i++) {
                        pages.push(i);
                    }
                    return pages;
                }
            }
        }).mount('#app');
    </script>
</body>
</html>