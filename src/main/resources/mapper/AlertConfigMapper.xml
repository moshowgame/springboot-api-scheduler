<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.software.dev.mapper.AlertConfigMapper">
    
    <insert id="insert" parameterType="com.software.dev.entity.AlertConfig">
        INSERT INTO alert_config (id, task_id, failure_rate_threshold, check_interval, 
                               api_url, http_method, headers, body, enabled, create_time, update_time)
        VALUES (#{id}, #{taskId}, #{failureRateThreshold}, #{checkInterval}, 
                #{apiUrl}, #{httpMethod}, #{headers}, #{body}, #{enabled}, 
                #{createTime}, #{updateTime})
    </insert>
    
    <update id="update" parameterType="com.software.dev.entity.AlertConfig">
        UPDATE alert_config 
        SET task_id = #{taskId}, 
            failure_rate_threshold = #{failureRateThreshold}, 
            check_interval = #{checkInterval}, 
            api_url = #{apiUrl}, 
            http_method = #{httpMethod}, 
            headers = #{headers}, 
            body = #{body}, 
            enabled = #{enabled}, 
            update_time = #{updateTime}
        WHERE id = #{id}
    </update>
    
    <select id="selectById" resultType="com.software.dev.entity.AlertConfig">
        SELECT id, task_id as taskId, failure_rate_threshold as failureRateThreshold, 
               check_interval as checkInterval, api_url as apiUrl, http_method as httpMethod, 
               headers, body, enabled, create_time as createTime, update_time as updateTime, 
               last_check_time as lastCheckTime
        FROM alert_config
        WHERE id = #{id}
    </select>
    
    <select id="selectByTaskId" resultType="com.software.dev.entity.AlertConfig">
        SELECT id, task_id as taskId, failure_rate_threshold as failureRateThreshold, 
               check_interval as checkInterval, api_url as apiUrl, http_method as httpMethod, 
               headers, body, enabled, create_time as createTime, update_time as updateTime, 
               last_check_time as lastCheckTime
        FROM alert_config
        WHERE task_id = #{taskId}
    </select>
    
    <select id="selectAllEnabled" resultType="com.software.dev.entity.AlertConfig">
        SELECT id, task_id as taskId, failure_rate_threshold as failureRateThreshold, 
               check_interval as checkInterval, api_url as apiUrl, http_method as httpMethod, 
               headers, body, enabled, create_time as createTime, update_time as updateTime, 
               last_check_time as lastCheckTime
        FROM alert_config
        WHERE enabled = true
    </select>
    
    <delete id="deleteById">
        DELETE FROM alert_config WHERE id = #{id}
    </delete>
    
    <delete id="deleteByTaskId">
        DELETE FROM alert_config WHERE task_id = #{taskId}
    </delete>
    
    <update id="updateTaskAlertEnabled">
        UPDATE api_task SET alert_enabled = #{enabled} WHERE id = #{taskId}
    </update>
    
    <update id="updateLastCheckTime">
        UPDATE alert_config SET last_check_time = NOW() WHERE id = #{id}
    </update>
    
</mapper>